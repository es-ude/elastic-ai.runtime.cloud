// unit test setup for all subprojects
subprojects {
  apply plugin: 'java'
  apply plugin: 'jacoco'

  sourceCompatibility = '17'

  repositories {
    mavenCentral()
  }

  dependencies {
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter:5.8.2'

    testImplementation 'org.slf4j:slf4j-simple:2.0.0-alpha1'
    testImplementation 'org.testcontainers:testcontainers:1.16.3'
    testImplementation 'org.testcontainers:junit-jupiter:1.16.3'
  }

  test {
    useJUnitPlatform()
    testLogging {
      events "passed", "skipped", "failed"
    }
    finalizedBy jacocoTestReport
  }

  jacocoTestReport {
    // tests are required to run before generating the report
    dependsOn test

    // change output directory of jacoco report
    reports {
      html.outputLocation = layout.projectDirectory.dir("jacocoReport")
    }
  }

  clean {
    // update clean task to delete old jacoco reports
    delete "${projectDir}/jacocoReport"
  }
}
